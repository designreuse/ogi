<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="vitrine" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="9c93a378-d1d0-4914-b9e5-2435be506bd9">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="297"/>
	<parameter name="reference" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["D:\\Developpement\\Master\\Java7\\workspace\\ogi\\ogi-parent\\ogi-services\\src\\main\\jasperreports\\"]]></defaultValueExpression>
	</parameter>
	<parameter name="ROOT_DIR" class="java.lang.String"/>
	<parameter name="DOC_DIR" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
(SELECT DOC_PATH
FROM TA_DOCUMENT DOC
JOIN TJ_PRP_DOC TJ ON DOC.DOC_ID=TJ.DOC_ID
JOIN TA_PROPERTY PRP ON PRP.PRO_ID=TJ.PRO_ID
WHERE
PRP.PRO_REFERENCE=$P{reference}
AND DOC_ORDER=1) AS PHOTO1,
(SELECT DOC_PATH
FROM TA_DOCUMENT DOC
JOIN TJ_PRP_DOC TJ ON DOC.DOC_ID=TJ.DOC_ID
JOIN TA_PROPERTY PRP ON PRP.PRO_ID=TJ.PRO_ID
WHERE
PRP.PRO_REFERENCE=$P{reference}
AND DOC_ORDER=2)  AS PHOTO2,
(SELECT DOC_PATH
FROM TA_DOCUMENT DOC
JOIN TJ_PRP_DOC TJ ON DOC.DOC_ID=TJ.DOC_ID
JOIN TA_PROPERTY PRP ON PRP.PRO_ID=TJ.PRO_ID
WHERE
PRP.PRO_REFERENCE=$P{reference}
AND DOC_ORDER=3)  AS PHOTO3,

ta_address.ADD_CITY AS CITY,

SUBSTRING(DSC_LABEL, 1, IF(INSTR(DSC_LABEL,'\n\n')<>0, INSTR(DSC_LABEL,'\n\n')+1,LENGTH(DSC_LABEL))) AS DSC_LABEL1,
SUBSTRING(DSC_LABEL, INSTR(DSC_LABEL,'\n\n') + 2, LENGTH(DSC_LABEL)) AS DSC_LABEL2,

sal.sal_mand_type AS MANDAT_TYPE,
IFNULL(sal.`SAL_PRICE`, 0) + IFNULL(sal.`SAL_COMMISSION`, 0) AS PRIX

FROM TA_PROPERTY prp
JOIN TA_SALE sal ON sal.pro_id=prp.pro_id
LEFT JOIN ta_address ON ta_address.`ADD_ID` = prp.`ADD_ID`
LEFT JOIN TA_DESCRIPTION DESCRIPTION ON DESCRIPTION.PRO_ID=PRP.PRO_ID AND DESCRIPTION.DSC_TYPE='VITRINE'

WHERE prp.pro_reference=$P{reference}]]>
	</queryString>
	<field name="PHOTO1" class="java.lang.String"/>
	<field name="PHOTO2" class="java.lang.String"/>
	<field name="PHOTO3" class="java.lang.String"/>
	<field name="CITY" class="java.lang.String"/>
	<field name="DSC_LABEL1" class="java.lang.String"/>
	<field name="DSC_LABEL2" class="java.lang.String"/>
	<field name="MANDAT_TYPE" class="java.lang.String"/>
	<field name="PRIX" class="java.lang.Double"/>
	<detail>
		<band height="802" splitType="Stretch">
			<image scaleImage="FillFrame">
				<reportElement mode="Opaque" x="87" y="15" width="379" height="313" isPrintWhenDetailOverflows="true" uuid="b5b68dc5-524c-4d4f-9565-6ada447307f6">
					<printWhenExpression><![CDATA[java.nio.file.Files.exists(java.nio.file.Paths.get($P{DOC_DIR} + $F{PHOTO1}))]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{DOC_DIR} + $F{PHOTO1}]]></imageExpression>
			</image>
			<textField>
				<reportElement x="0" y="328" width="555" height="49" forecolor="#484545" uuid="cfeaf2fb-9d52-4476-a06f-500139233cce"/>
				<textElement textAlignment="Center">
					<font fontName="Arial" size="36"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{CITY}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="0" y="641" width="179" height="161" uuid="1a0f4ad8-06c6-487d-8c8b-b118e0c8002d">
					<printWhenExpression><![CDATA[java.nio.file.Files.exists(java.nio.file.Paths.get($P{DOC_DIR} + $P{reference}+ "/dpe/kwh-260.png"))]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{DOC_DIR} + $P{reference}+ "/dpe/kwh-260.png"]]></imageExpression>
			</image>
			<image>
				<reportElement positionType="Float" x="363" y="448" width="192" height="130" uuid="a188fba2-43f0-44c7-9ad1-b2a097a99867">
					<printWhenExpression><![CDATA[java.nio.file.Files.exists(java.nio.file.Paths.get($P{DOC_DIR} + $F{PHOTO2}))]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{DOC_DIR} + $F{PHOTO2}]]></imageExpression>
			</image>
			<image>
				<reportElement positionType="Float" x="363" y="600" width="192" height="130" uuid="c79897f1-d5c3-4ddb-b7d5-ef387684df42">
					<printWhenExpression><![CDATA[java.nio.file.Files.exists(java.nio.file.Paths.get($P{DOC_DIR} + $F{PHOTO3}))]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{DOC_DIR} + $F{PHOTO3}]]></imageExpression>
			</image>
			<frame>
				<reportElement mode="Transparent" x="37" y="530" width="286" height="106" forecolor="#00FF66" backcolor="#66CC00" uuid="15bc5f0a-ea35-43de-9f4a-5b79e87d3440"/>
				<box>
					<pen lineWidth="0.25" lineColor="#990099"/>
					<topPen lineWidth="0.25" lineColor="#990099"/>
					<leftPen lineWidth="0.25" lineColor="#990099"/>
					<bottomPen lineWidth="0.25" lineColor="#990099"/>
					<rightPen lineWidth="0.25" lineColor="#990099"/>
				</box>
				<textField>
					<reportElement x="11" y="7" width="264" height="89" forecolor="#A01755" uuid="a8a3976b-9c4e-4c62-b060-93490407e867"/>
					<textElement>
						<font fontName="Arial" size="18" isBold="false"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{DSC_LABEL2}.replaceAll("->","→")]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement mode="Transparent" x="37" y="396" width="286" height="123" forecolor="#00FF66" backcolor="#66CC00" uuid="a9d35070-70f6-4abf-a66c-6293c238f6be"/>
				<box>
					<pen lineWidth="0.25" lineColor="#666666"/>
					<topPen lineWidth="0.25" lineColor="#666666"/>
					<leftPen lineWidth="0.25" lineColor="#666666"/>
					<bottomPen lineWidth="0.25" lineColor="#666666"/>
					<rightPen lineWidth="0.25" lineColor="#666666"/>
				</box>
				<textField>
					<reportElement x="11" y="7" width="264" height="106" forecolor="#999999" uuid="e77c9bc9-f33c-49ea-9d7e-b238af03c812"/>
					<textElement>
						<font fontName="Arial" size="18" isBold="false"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{DSC_LABEL1}.replaceAll("->","→");]]></textFieldExpression>
				</textField>
			</frame>
			<image>
				<reportElement positionType="FixRelativeToBottom" x="338" y="763" width="217" height="39" uuid="c6e12a79-a7a1-44cd-9926-b8c624f63500"/>
				<imageExpression><![CDATA[$P{ROOT_DIR} + "img/vitrine_footer.png"]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="515" y="396" width="18" height="35" forecolor="#A01755" uuid="00062701-8f62-446f-a96b-a8d566189363"/>
				<textElement>
					<font fontName="Arial" size="30" isBold="true"/>
				</textElement>
				<text><![CDATA[€]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" pattern="#,##0">
				<reportElement x="363" y="396" width="152" height="35" forecolor="#A01755" uuid="94d4cc6c-6b22-4c35-aacf-5d9c4bdd3284"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="30" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{PRIX}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
